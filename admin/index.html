<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Manager - Tereza Výtisková</title>
    <link rel="icon" href="../assets/images/logo.png" type="image/png">
  </head>
  <body>
    <!-- Use Decap CMS instead of Netlify CMS for better GitHub Pages support -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    
    <!-- Personal Access Token Authentication -->
    <script>
      // Check if we have a token in localStorage
      const token = localStorage.getItem('github-token');
      
      if (!token) {
        // Show token input form
        document.body.innerHTML = `
          <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            <div style="text-align: center; max-width: 500px; padding: 20px;">
              <h2>Přihlášení do CMS</h2>
              <p style="margin-bottom: 20px;">Zadejte váš GitHub Personal Access Token pro přístup k editaci obsahu.</p>
              <input 
                type="password" 
                id="token-input" 
                placeholder="Váš GitHub Personal Access Token"
                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; font-size: 14px;"
              />
              <button 
                onclick="saveToken()" 
                style="width: 100%; padding: 12px 24px; background-color: #24292e; color: white; border: none; border-radius: 4px; font-weight: 600; cursor: pointer;"
              >
                Přihlásit se
              </button>
              <p style="margin-top: 20px; font-size: 12px; color: #666;">
                Token se uloží pouze v tomto prohlížeči a nebude odeslán nikam jinam než na GitHub API.
              </p>
            </div>
          </div>
        `;
        
        window.saveToken = function() {
          const tokenInput = document.getElementById('token-input');
          const token = tokenInput.value.trim();
          
          if (!token) {
            alert('Zadejte prosím váš GitHub Personal Access Token');
            return;
          }
          
          localStorage.setItem('github-token', token);
          location.reload();
        };
      } else {
        // We have a token, configure CMS
        window.CMS_MANUAL_INIT = true;
        
        // Initialize CMS with custom authentication
        CMS.init({
          config: {
            backend: {
              name: 'github',
              repo: 'kocab22/terka-web',
              branch: 'main',
              // Use the stored token
              auth_type: 'implicit',
              app_id: token
            }
          }
        });
      }
      
      // Add logout functionality
      window.logout = function() {
        localStorage.removeItem('github-token');
        location.reload();
      };
    </script>
  </body>
</html>
